# 幽梦个人助手开发指南

**版本**：1.0.0  
**状态**：已完成  
**最后更新**：2026-02-16

---

## 1. 项目概述

幽梦个人助手是一款**本地优先、周期任务驱动**的个人效率工具，核心功能是管理**日常、周常、特殊**三类任务，支持**自定义重置时间/星期**、**标签系统**、**回收站**、**全局搜索**等特性。

产品定位为"极简、稳定、可扩展"，采用 QQ 风格的现代化界面设计。

---

## 2. 技术栈

| 组件 | 技术选型 | 说明 |
|------|----------|------|
| 编程语言 | Python 3.7+ | 跨平台支持 |
| GUI框架 | PyQt5 5.15+ | 成熟稳定，资源丰富 |
| 数据库 | SQLite3 | 单文件，无需服务器 |
| 数据访问层 | Repository模式 | 封装所有SQL操作 |
| 业务逻辑层 | TaskManager类 | 发射信号，UI通过信号更新 |
| 配置管理 | JSON文件 | 位于应用目录 |
| 日志 | Python logging | 按会话隔离，7天自动清理 |
| 打包工具 | PyInstaller | 打包为单文件EXE |
| 安装程序 | Inno Setup | Windows安装包 |

---

## 3. 项目结构

```
YoumengPersonalAssistant/
├── main.py                     # 应用程序入口
├── requirements.txt            # Python 依赖
├── YoumengAssistant.spec       # PyInstaller 打包配置
├── installer.iss               # Inno Setup 安装脚本
├── ChineseSimplified.isl       # 中文语言文件
├── build.bat                   # 一键打包脚本
│
├── config/
│   └── settings.py             # 配置管理（APP_VERSION, APP_NAME）
│
├── core/
│   ├── task_manager.py         # 任务管理器（业务逻辑）
│   └── auto_reset_service.py   # 自动重置服务（启动+每小时检测）
│
├── data/
│   ├── models.py               # 数据模型（Task, Tag）
│   ├── database.py             # 数据库连接管理
│   └── repository.py           # 数据仓库实现
│
├── ui/
│   ├── main_window.py          # 主窗口（含边缘拖拽调整大小）
│   ├── task_card.py            # 任务卡片组件
│   ├── task_dialog.py          # 任务对话框
│   ├── settings_dialog.py      # 设置对话框
│   ├── recycle_bin_dialog.py   # 回收站对话框（颜色编码）
│   ├── animations/
│   │   └── animation_manager.py
│   ├── components/
│   │   ├── animated_stacked_widget.py
│   │   ├── search_bar.py       # 顶部搜索栏
│   │   ├── sliding_panel.py    # 滑动面板
│   │   ├── task_form_widget.py # 任务表单
│   │   └── settings_widget.py  # 设置面板
│   └── styles/
│       └── qq_style.py         # QQ风格样式常量
│
├── utils/
│   ├── logger.py               # 日志管理（LogManager）
│   ├── common.py               # 通用工具函数
│   ├── exceptions.py           # 自定义异常
│   └── resource.py             # 资源路径管理（Icons类）
│
└── resources/
    └── icons/
        ├── app.ico             # 应用图标
        ├── check_green.svg     # 绿色勾选图标
        └── check_blue.svg      # 蓝色勾选图标
```

---

## 4. 架构设计

### 4.1 分层架构

| 层级 | 目录 | 职责 |
|------|------|------|
| 数据层 | `data/` | 数据模型、数据库操作、数据访问接口 |
| 业务层 | `core/` | 核心业务逻辑、自动重置服务 |
| 表示层 | `ui/` | 用户界面组件、动画、样式 |
| 工具层 | `utils/`, `config/` | 日志、配置、资源管理 |

### 4.2 信号槽通信

组件间通信使用 PyQt5 信号槽机制：

```
TaskManager.task_added      → MainWindow 刷新列表
TaskManager.task_updated    → MainWindow 刷新列表
TaskManager.task_deleted    → MainWindow 刷新列表
AutoResetService.daily_reset_performed  → MainWindow 刷新
AutoResetService.weekly_reset_performed → MainWindow 刷新
```

---

## 5. 核心功能

### 5.1 任务管理

- **任务分类**：日常任务、周常任务、特殊任务
- **优先级系统**：四级（紧急/优先/普通/建议）
- **标签系统**：多标签支持
- **任务字段**：标题、描述、要求、优先级、截止日期等

### 5.2 自动重置

- 启动时立即检测并执行重置
- 之后每小时检测一次
- 日常任务：每日重置时间后重置
- 周常任务：每周指定日期重置

### 5.3 回收站

- 软删除机制
- 颜色编码：7天内(橙色)、30天内(灰色)、30天以上(深灰)
- 显示完整任务详情（含要求和优先级）

### 5.4 搜索功能

- 支持模糊/精确搜索
- 搜索范围：标题、描述、要求、标签

---

## 6. 数据库设计

### 6.1 任务表 (tasks)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键 |
| title | TEXT | 任务标题 |
| description | TEXT | 任务描述 |
| requirements | TEXT | 任务要求 |
| priority | INTEGER | 优先级（0-3） |
| section | TEXT | 分区（daily/weekly/once） |
| is_completed | BOOLEAN | 是否完成 |
| due_date | DATE | 截止日期（特殊任务） |
| reset_weekday | INTEGER | 重置星期（周常任务，0-6） |
| sort_order | INTEGER | 排序顺序 |
| is_deleted | BOOLEAN | 软删除标记 |
| deleted_at | DATETIME | 删除时间 |

### 6.2 标签表 (tags)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键 |
| name | TEXT | 标签名称（唯一） |

### 6.3 任务-标签关联表 (task_tags)

| 字段 | 类型 | 说明 |
|------|------|------|
| task_id | INTEGER | 任务ID |
| tag_id | INTEGER | 标签ID |

---

## 7. 配置说明

配置文件：`config.json`

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `app.version` | 应用版本 | `1.0.0` |
| `task.daily_reset_time` | 日常重置时间 | `06:00` |
| `task.weekly_reset_day` | 周常重置日（0=周一） | `0` |
| `task.auto_reset_enabled` | 启用自动重置 | `true` |
| `task.recycle_bin_capacity` | 回收站容量 | `100` |
| `ui.default_section` | 默认分区 | `0` |
| `ui.show_completed` | 显示已完成任务 | `true` |

---

## 8. 打包发布

### 8.1 开发环境运行

```bash
# 创建虚拟环境
python -m venv .venv
.venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 运行
python main.py
```

### 8.2 打包 EXE

```bash
# 方式1：使用打包脚本
build.bat

# 方式2：手动打包
pyinstaller YoumengAssistant.spec --clean
```

### 8.3 创建安装程序

1. 安装 [Inno Setup 6](https://jrsoftware.org/isdl.php)
2. 打开 `installer.iss`
3. 点击编译

输出：`installer_output/幽梦个人助手_安装程序_v1.0.0.exe`

---

## 9. 版本历史

### v1.0.0 (2026-02-16)

- 完成核心功能开发
- 任务管理（日常/周常/特殊）
- 自动重置服务
- 回收站功能
- QQ风格界面
- 打包发布支持

---

## 10. 开发规范

### 10.1 代码风格

- 遵循 PEP 8 规范
- 类名使用 PascalCase
- 函数/变量使用 snake_case
- 私有方法以 `_` 开头

### 10.2 注释规范

- 模块/类/函数使用 docstring
- 复杂逻辑添加行内注释
- 中文注释优先

### 10.3 版本管理

- 版本号统一在 `config/settings.py` 中定义
- 图标路径统一在 `utils/resource.py` 中管理

---

## 许可证

MIT License - Copyright (c) 2026 幽梦工作室
